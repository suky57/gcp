name: Trigger Terraform Cloud Run
#test ci/cd
on:
  workflow_dispatch: # Manual trigger
  push:              # Or any other event you want

jobs:
  terraform-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Get Workspace ID
        run: |
          WORKSPACE_ID=$(curl -s \
            --header "Authorization: Bearer ${{ secrets.TF_API_TOKEN }}" \
            https://app.terraform.io/api/v2/organizations/${{ secrets.TF_ORG }}/workspaces/${{ secrets.TF_WORKSPACE }} | jq -r '.data.id')
          echo "Workspace ID: $WORKSPACE_ID"
          echo "WORKSPACE_ID=$WORKSPACE_ID" >> $GITHUB_ENV

      - name: Trigger Terraform Cloud Run
        run: |
          curl \
            --header "Authorization: Bearer ${{ secrets.TF_API_TOKEN }}" \
            --header "Content-Type: application/vnd.api+json" \
            --request POST \
            --data "{
              \"data\": {
                \"attributes\": {
                  \"is-destroy\": false,
                  \"message\": \"Triggered by GitHub Actions\"
                },
                \"type\": \"runs\",
                \"relationships\": {
                  \"workspace\": {
                    \"data\": {
                      \"type\": \"workspaces\",
                      \"id\": \"${WORKSPACE_ID}\"
                    }
                  }
                }
              }
            }" \
            https://app.terraform.io/api/v2/runs -v
            # End of file1